<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CryoTech | Página Inicial</title>
  <link rel="stylesheet" href="css/estilo.css" />
  <link rel="icon" href="css/Imagens/logo1.png" />
</head>


<body class="pagina-cadastro">
  <div class="alerta_erro">
    <div class="card_erro" id="cardErro">
      <span id="mensagem_erro"></span>
    </div>
  </div>
  <div class="background-cadastro">
    <div class="cadastro">
      <div class="img-cadastro">
        <ul>
          <li><img onclick="imagem()" src="css/Imagens/logo1.png" alt=""></li>
        </ul>
      </div>

      <div class="cadastro-right">
        <div class="cadastro-texto">
          <h2 onclick="imagem()">Bem vindo a <span>Cryo</span>Tech</h2> <br><br>
        </div>

        <label>Nome do responsável</label>
        <input id="nome_input" type="text" value="">

        <label>CPF</label>
        <input id="cpf_input" type="text" value="">

        <label>Data de nascimento</label>
        <input id="dtNasc_input" type="date" value="">

        <label>E-mail</label>
        <input id="email_input" type="text" value="">

        <label>Telefone para contato</label>
        <input id="telefone_input" type="text" value="">

        <label>Senha</label>
        <input id="senha_input" type="password" value="">
        <div id="forca_senha"></div>

        <label>Confirmar Senha</label>
        <input id="confirmacao_senha_input" type="password" value="">
        <div id="forca_senha"></div>

        <label>Token da empresa</label>
        <input id="token_input" type="text" value="">

        <div id="div_msg"></div>

        <div class="remember">
          <input type="checkbox" id="remember">
          <label for="remember">Lembrar-me</label>
        </div>

        <p>Caso sua empresa ainda não tenha um cadastro <a href="index.html#contato ">clique aqui</a></p>

        <button onclick="cadastrar()">Cadastre-se</button>
      </div>
    </div>
  </div>
  <div class="footer">
    <div class="footer-container">
      <div class="footer-logo">
        <h2>CryoTech</h2>
        <p>Garantindo a temperatura ideal do início ao fim da cadeia de frio.</p>
      </div>

      <div class="footer-links">
        <a href="index.html">Início</a>
        <a href="#solucoes">Soluções</a>
        <a href="calcfinanceira.html">Calculadora</a>
        <a href="#contato">Contato</a>
      </div>

      <div class="footer-copy">
        <p>&copy; 2025 CryoTech. Todos os direitos reservados.</p>
      </div>
    </div>
  </div>
</body>

<script>

  function imagem() {
    window.location.href = "index.html";
  }

  function erro(msg) {
    document.querySelector(".alerta_erro").style.display = "flex";
    mensagem_erro.innerHTML = msg;
    setTimeout(() => document.querySelector(".alerta_erro").style.display = "none", 1500);
  }
  // Array para armazenar empresas cadastradas para validação de código de ativação 

  function cadastrar() {

    var nomeVar = nome_input.value.trim();
    var cpfVar = cpf_input.value.trim();
    var dtNascVar = dtNasc_input.value;
    var emailVar = email_input.value.trim();
    var telefoneVar = telefone_input.value.trim();
    var senhaVar = senha_input.value;
    var confirmacaoSenhaVar = confirmacao_senha_input.value;
    var tokenVar = token_input.value.trim();


    if (nomeVar.length < 3) {
      return erro("O nome deve ter pelo menos 3 caracteres.");
    }
    if (!/^\d{11}$/.test(cpfVar)) {
      return erro("O CPF deve conter exatamente 11 números.");
    }
    if (!emailVar.includes('@')) {
      return erro("Digite um e-mail válido.");
    }
    if (!/^\d{10,11}$/.test(telefoneVar)) {
      return erro("O telefone deve conter 10 a 11 dígitos.");
    }
    if (!/^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(senhaVar)) {
      return erro("A senha deve conter: 8 caracteres, 1 letra maiúscula, 1 minúscula, 1 número e 1 caractere especial.");
    }
    if (senhaVar != confirmacaoSenhaVar)  {
      return erro("As senhas não coincidem.");
    }
    if (tokenVar == "") {
      return erro("O token da empresa não pode estar vazio.");
    }
    // Enviando o valor da nova input
    fetch("/empresas/cadastrarFuncionario", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        nomeServer: nomeVar,
        cpfServer: cpfVar,
        dtNascServer: dtNascVar,
        emailServer: emailVar,
        telefoneServer: telefoneVar,
        senhaServer: senhaVar,
        tokenServer: tokenVar,
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          document.querySelector(".alerta_erro").style.display = "flex";


          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para home...";

          setTimeout(() => {
            window.location = "index.html";
          }, "2000");

        } else {
          document.querySelector(".alerta_erro").style.display = "flex";

          mensagem_erro.innerHTML = "Houve um erro ao realizar o cadastro!";

          setTimeout(sumirMensagem, 2000);
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }

  function sumirMensagem() {

    document.querySelector(".alerta_erro").style.display = "none";
  }


  // Listando empresas cadastradas 
  // function listar() {
  //   fetch("/empresas/listar", {
  //     method: "GET",
  //   })
  //     .then(function (resposta) {
  //       resposta.json().then((empresas) => {
  //         empresas.forEach((empresa) => {
  //           listaEmpresasCadastradas.push(empresa);

  //           console.log("listaEmpresasCadastradas")
  //           console.log(listaEmpresasCadastradas[0].token_ativacao)
  //         });
  //       });
  //     })
  //     .catch(function (resposta) {
  //       console.log(`#ERRO: ${resposta}`);
  //     });
  // }


</script>